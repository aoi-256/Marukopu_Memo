# LEDをつけてみよう

プログラム作成の第一歩として、LEDをつけるコードを作成してみよう！

## 作業の概要

(0) 初期設定をがんばる

(1) wrapper.cppにLEDをつけたり消したりするコードを書く

(2) LEDが付くか試してみる（配線不要！！）


## ピンの設定

（Project名）.iocのファイルを開くことで、STM32のどのピンにどんな機能を割り当てるかを決めることができる

初期設定のままでPA5（画像の赤枠）に内蔵LEDが割り当てられている

このPA5に電気を送ってあげればLEDがつく

![スクリーンショット (160)](https://github.com/user-attachments/assets/8650d92c-2c73-452e-a482-27a4e811d7fb)

## 関数の解説

LEDをつけるためには、使うSTM32のピンと電圧をプログラムに書き込む必要がある

ここでは、HAL_GPIO_WritePin関数を使う

### HAL_GPIO_WritePin()
```
HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5, GPIO_PIN_SET);
```

ここからは、関数の引数（括弧内にある変数のことで、関数に渡す値になる）について説明する

### 第1引数 GPIOA
```
ピンの種類（PA、PB、PC）などを示している

PAのピンならGPIOA、PBのピンならGPIOBのように設定する

今回はPA5のピンであるため、GPIOAとしている
```
### 第2引数 GPIO_PIN_5
```
ピンの番号を示している

今回はPA5のピンであるため、GPIO_PIN_5としてある
```
### 第3引数 GPIO_PIN_SET
```
ピンから出力される電圧を示している

GPIO_PIN_SET　   3.3V
GPIO_PIN_RESET   0v

に対応している
LEDをつけたいときはSETに、LEDを消したいときはRESETにしてあげればよい
```
この関数を使うことで、簡単にLEDを付けたり消したりできる

STM32の実行はかなり高速であるため、SETとRESETを繰り返すだけでは何が起きているかわかりにくい

(人間の目だと早すぎてわからない）


そこで、処理をいったんストップさせるHAL_Delay関数を使う

### HAL_Delay()
```
HAL_Delay(500);
```

### 第1引数　500
```
この関数の()に入れた数字(ミリ秒/ 0.001s)分だけプログラムが待機してくれる

ここでは、500ms(ミリ秒)としているため、0.5s待機してくれる
```

## サンプルコード

ここまで紹介した関数を使って、プログラムを作成する

今回使う、PA5は内蔵のLEDとつながっているため、配線をしなくてよい！

プログラムを見るときの注意点として
```
void init()はプログラム実行時に一度だけ実行される部分になる

void loop()は void init()が終わった後に、繰り返し実行される部分である
```

これにより、実行時に1回だけ行う処理と繰り返し行う処理を分けて書くことができる

このプログラムでは、実行時にまずLEDをつけて１秒待機させた後に

0.5秒ごとにLEDが付いたり消えたりするようにしている

```
void init(){

　//LEDをつける
  HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5, GPIO_PIN_SET);

　//1000ms(1s)待機
  HAL_Delay(1000);

}

void loop(){

　HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5, GPIO_PIN_RESET);

　HAL_Delay(500);

  HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5, GPIO_PIN_SET);

  HAL_Delay(500);

}
```
## やってみよう

・サンプルコードを書き換えて、LEDが付いたり消えたりする間隔を2秒に変えてみよう！

## おわりに

今回は、基本のLEDをつけるプログラムを作成した

今後のプログラム作成中にも、途中でLEDをつけることでエラーが出てないかのチェックをすることができるので

困ったらLEDをつけてみるといいかもしれない！

[次のページ](12_シリアル通信.md)

[STM32-メニュー](index.md)

