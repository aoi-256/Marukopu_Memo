# I2C通信をやってみよう（開発バージョン)

I2Cの通信方法について説明するよ！

## I2C通信とは

> [!NOTE] 
>
> I2C通信は、データのやり取りに使う線と、タイミングを合わせるために使う線の2本を使って通信する
> 
> 安定性が高く、センサーと400kbps（そこそこはやい）で通信できるため、めちゃくちゃ便利
>
> 慣れてしまえば、かなり簡単に通信ができて便利なので頑張って覚えてみてね

## I2C通信をするためには

I2C通信の細かい説明をすると、結構難しくなってしまうので

ここでは、プログラムを書く上な要素を4つ紹介しておきます

> [!TIP]
>　
> I2C通信をする上では、この4つを覚えておこう!
>
> - データを送る相手（I2Cアドレス)
> - データの送信場所 (レジスタアドレス）
> - 送信/受信するデータ　(データ)
> - データの長さ（データ長）

## 実際に通信をしてみよう！

I2C通信をする上で使う関数は、

**書き込み（送信）**
```cpp
HAL_I2C_Mem_Write(&hi2c2, I2C_ADDR, REGISTER, 1, &send_data, 1, 10);
```

**読み取り（受信）**
```cpp
HAL_I2C_Mem_Read(&hi2c2, I2C_ADDR, REGISTER, 1, &receive_data, 1, 10);
```

> [!NOTE]
>
> この関数の引数について(1や10といった数字はそのままでok!)
>
> - &hi2c2・・・使うi2cのピン
> - I2C_ADDR・・・I2Cアドレス
> - REGISTER・・・レジスタアドレス
> - ○○○_data・・・送信/受信するデータ（ポインタ）
>

<details>

 <summary> 細かいお話 </summary>

 <br>

- **一番最後の'10'という引数について**

これは、最大時間を設定している

通常は一瞬で通信が成功するが、上手くいかなかったときこの数字の秒数（単位はms)で諦めるように設定できる
 
<br>

- **REGISTERと&send_dataの後の'1'という引数について**

これは、隣り合う複数のレジスタに一度に書き込むときに使う

例えば、0x10から0x12までの3つのレジスタに書き込みたいときは、send_data[3]のように3つの要素を持つ配列とセットで
このように書くことができる

```cpp
HAL_I2C_Mem_Write(&hi2c2, I2C_ADDR, 0x10, 3, send_data, 3, 10);
```

センサーの値などはxyzのデータが近いレジスタにあることがほとんどなので、知っておくと便利かも

</details>

* * *

# I2C通信をやってみよう（開発バージョン)

I2Cの通信方法について説明するよ！

## I2C通信とは

これまで扱ったusartの仲間みたいなもの

いくつか特徴があるので、3つだけ紹介してみる

:::note info

- 通信速度がそこそこ早い

- データ用の線とクロック用の線を使う

- 複数のセンサーなどを同じ配線で扱える
:::

## I2C通信をするためには

I2C通信の細かい説明をすると、結構難しくなってしまうので

ここでは、プログラムを書く上な要素を4つ紹介しておきます

:::note info
I2C通信をする上では、この4つを覚えておこう!

 - データを送る相手（I2Cアドレス)
 - データの送信場所 (レジスタアドレス）
 - 送信/受信するデータ　(データ)
 - データの長さ（データ長）
:::

## 実際に通信をしてみよう！

I2C通信をする上で使う関数は、

**書き込み（送信）**
```cpp
HAL_I2C_Mem_Write(&hi2c2, I2C_ADDR, REGISTER, 1, &send_data, 1, 10);
```

**読み取り（受信）**
```cpp
HAL_I2C_Mem_Read(&hi2c2, I2C_ADDR, REGISTER, 1, &receive_data, 1, 10);
```
