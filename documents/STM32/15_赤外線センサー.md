
# 赤外線センサーを実装してみる

大会で必須になることが多い機能の１つなので、ぜひできるようになってほしい

センサーという割には、簡単に実装できるよ

電磁気学ほんとにわからないので、細かいところ雰囲気で書いてます
とりあえず動けばいいの精神！


## 作業の概要

(1) フォトトランジスタから電流を受け取る

(2) 電流を値に変換(A/D変換)する

(3) 読み取った値を送信する（シリアル通信)

## フォトトランジスタとは

光を受けると、その強度に応じて電流を流してくれる装置

強い光が当たるほど、強い電流が流れるので強度の測定ができる

## ピンの設定 

PA0にADC1_IN0を割り当てる

ここでは、ADC1のタブからIN0を選択するのみでよい

## プログラム

今回のコードは結構簡単

紹介する関数を順番に実行するだけでよい(wrapper.cpp loop()の中に書こう)

入力された値をシリアル通信などでモニターできるようにしておくとよい

### 使用する関数

#### A/D変換のスタート

ADC変換をスタートするための関数

&hadc(設定したadcの番号）を入力してね

```
HAL_ADC_Start(&hadc1);
```

#### A/D変換が終了するまで待機

変換が終わるまで待たないと値がもらえないのでこの関数を書いておく

第2引数は最大の待機時間を渡す、取り出す1000msにしておけば問題ない

```
HAL_ADC_PollForConversion(&hadc1,1000);
```

#### A/D変換した値の取得

変換が終了した後、任意の変数に値を格納できる

値は0~4095(12ビット）であるので、uint16_tなどを使えばよい

```
uint16_t (変数名) = HAL_ADC_GetValue(&hadc1);
```

値を格納した変数をstring変換して、シリアル通信で出力してみよう

## 回路

3.3v →　フォトトランジスタ →　マイコンの入力 でよい

また、大きな電流が流れてしまうことへの対策として

フォトトランジスタ　→ 10KΩの抵抗 → GND の回路も並列で組んでおくと安心である

## 実行結果

0~4095の値が赤外線の強さに応じて出力されれば成功

フォトトランジスタに入る光を遮ると出力される値が小さくなるはずなので、電気を消したりつけたりして確かめてみよう

## 終わりに
